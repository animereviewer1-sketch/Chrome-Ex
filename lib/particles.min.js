/**
 * Particles.js - Minimal Implementation
 * Leichtgewichtige Partikel-Animation f√ºr Chrome-Ex
 */
(function(window, document) {
  'use strict';

  var particlesJS = function(containerId, config) {
    var container = document.getElementById(containerId);
    if (!container) return;

    // Canvas erstellen
    var canvas = document.createElement('canvas');
    canvas.style.cssText = 'position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;';
    container.appendChild(canvas);
    
    var ctx = canvas.getContext('2d');
    var particles = [];
    var animationId = null;

    // Config Defaults
    var cfg = config.particles || {};
    var particleCount = (cfg.number && cfg.number.value) || 80;
    var particleColor = (cfg.color && cfg.color.value) || '#ffffff';
    var particleSize = (cfg.size && cfg.size.value) || 3;
    var particleSpeed = (cfg.move && cfg.move.speed) || 2;
    var lineLinked = cfg.line_linked || {};
    var lineDistance = lineLinked.distance || 150;
    var lineColor = lineLinked.color || particleColor;
    var lineOpacity = lineLinked.opacity || 0.2;
    var lineEnabled = lineLinked.enable !== false;

    // Resize Handler
    function resize() {
      canvas.width = container.offsetWidth || window.innerWidth;
      canvas.height = container.offsetHeight || window.innerHeight;
    }

    // Particle Class
    function Particle() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.vx = (Math.random() - 0.5) * particleSpeed;
      this.vy = (Math.random() - 0.5) * particleSpeed;
      this.size = Math.random() * particleSize + 1;
      this.opacity = Math.random() * 0.5 + 0.5;
    }

    Particle.prototype.update = function() {
      this.x += this.vx;
      this.y += this.vy;

      // Bounce off edges
      if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
      if (this.y < 0 || this.y > canvas.height) this.vy *= -1;

      // Keep in bounds
      this.x = Math.max(0, Math.min(canvas.width, this.x));
      this.y = Math.max(0, Math.min(canvas.height, this.y));
    };

    Particle.prototype.draw = function() {
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fillStyle = particleColor;
      ctx.globalAlpha = this.opacity;
      ctx.fill();
      ctx.globalAlpha = 1;
    };

    // Draw lines between particles
    function drawLines() {
      if (!lineEnabled) return;
      
      for (var i = 0; i < particles.length; i++) {
        for (var j = i + 1; j < particles.length; j++) {
          var dx = particles[i].x - particles[j].x;
          var dy = particles[i].y - particles[j].y;
          var dist = Math.sqrt(dx * dx + dy * dy);
          
          if (dist < lineDistance) {
            ctx.beginPath();
            ctx.moveTo(particles[i].x, particles[i].y);
            ctx.lineTo(particles[j].x, particles[j].y);
            ctx.strokeStyle = lineColor;
            ctx.globalAlpha = lineOpacity * (1 - dist / lineDistance);
            ctx.lineWidth = 1;
            ctx.stroke();
            ctx.globalAlpha = 1;
          }
        }
      }
    }

    // Animation Loop
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      particles.forEach(function(p) {
        p.update();
        p.draw();
      });
      
      drawLines();
      
      animationId = requestAnimationFrame(animate);
    }

    // Initialize
    function init() {
      resize();
      
      particles = [];
      for (var i = 0; i < particleCount; i++) {
        particles.push(new Particle());
      }
      
      if (animationId) cancelAnimationFrame(animationId);
      animate();
    }

    // Event Listeners
    window.addEventListener('resize', function() {
      resize();
    });

    init();

    // Return cleanup function
    return {
      destroy: function() {
        if (animationId) cancelAnimationFrame(animationId);
        if (canvas.parentNode) canvas.parentNode.removeChild(canvas);
      }
    };
  };

  // Export
  window.particlesJS = particlesJS;

})(window, document);
